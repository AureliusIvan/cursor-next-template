{"id":"cursor-next-template-1q0","title":"Create integrations page","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T13:50:30.68009491+07:00","created_by":"ivan","updated_at":"2026-01-05T13:51:37.581583379+07:00","closed_at":"2026-01-05T13:51:37.581583379+07:00","close_reason":"Closed"}
{"id":"cursor-next-template-252","title":"Fix: Replace remaining alert() calls with toast notifications","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:51:03.051621206+07:00","created_by":"ivan","updated_at":"2026-01-05T15:00:06.062667182+07:00","closed_at":"2026-01-05T15:00:06.062667182+07:00","close_reason":"Closed","labels":["frontend"]}
{"id":"cursor-next-template-8pn","title":"Fix: TypeScript type errors from `npx tsc --noEmit`","notes":"**Problem:**\nRunning `npx tsc --noEmit` reveals multiple TypeScript type errors across the codebase that need to be fixed.\n\n**Type Errors Found:**\n\n1. **Missing Prisma Client Types** (Multiple files):\n   - `Company`, `Contact`, `Project`, `Role` types not exported from `@prisma/client`\n   - Files affected:\n     - `app/(auth)/dashboard/crm/contacts/companies/companies-page-client.tsx`\n     - `app/(auth)/dashboard/crm/contacts/contacts-page-client.tsx`\n     - `app/(auth)/dashboard/projects/projects-page-client.tsx`\n     - `app/(auth)/dashboard/users/page.tsx`\n     - `app/(auth)/dashboard/users/users-page-client.tsx`\n     - `app/hooks/use-company-stream.ts`\n     - `components/crm/company-list.tsx`\n     - `components/crm/contact-list.tsx`\n     - `components/crm/project-edit-form.tsx`\n     - `components/crm/project-list.tsx`\n     - `components/users/create-user-dialog.tsx`\n     - `components/users/edit-user-dialog.tsx`\n     - `components/users/role-badge.tsx`\n     - `components/users/user-form.tsx`\n     - `components/users/user-list.tsx`\n\n2. **Missing `toast` function** (Multiple files):\n   - `toast` is not defined/imported\n   - Files affected:\n     - `components/crm/contact-form.tsx` (lines 91, 94)\n     - `components/crm/project-delete-dialog.tsx` (lines 31, 35)\n     - `components/crm/project-edit-form.tsx` (lines 56, 59)\n\n3. **User type mismatch**:\n   - `app/(auth)/dashboard/users/page.tsx` line 62\n   - Type expects `createdAt: string` but receives `Date`\n\n4. **React Resizable Panels import issues**:\n   - `components/ui/resizable.tsx`\n   - `PanelGroup` and `PanelResizeHandle` not found in module\n\n5. **Boolean type mismatch**:\n   - `components/users/user-form.tsx` line 44\n   - `boolean | undefined` not assignable to `boolean`\n\n6. **Next.js type issue**:\n   - `.next/types/validator.ts` line 206\n   - Cannot find module `../../app/search/page.js`\n\n7. **Notion API type mismatch**:\n   - `scripts/diagnose-notion.ts` line 134\n   - Type `\"database\"` not assignable to `\"page\" | \"data_source\"`\n\n8. **ImportMeta type issue**:\n   - `scripts/test-sync-api.ts` line 50\n   - Property `main` does not exist on `ImportMeta`\n\n**Root Cause:**\n- Prisma client may need regeneration (`bunx prisma generate`)\n- Missing imports for toast notifications (likely `sonner` or similar)\n- Type definitions may be out of sync with actual implementations\n- Some dependencies may have incorrect type definitions\n\n**Proposed Solution:**\n1. Regenerate Prisma client: `bunx prisma generate`\n2. Add missing `toast` imports from appropriate toast library\n3. Fix type mismatches (Date vs string, boolean vs boolean | undefined)\n4. Check and fix react-resizable-panels imports/version\n5. Fix or remove problematic Next.js validator reference\n6. Update Notion API type usage\n7. Fix ImportMeta.main usage or add type declaration\n\n**Files to modify:**\n- All files listed above with type errors\n- May need to check `package.json` for dependency versions\n- May need to update `tsconfig.json` if type issues persist\n\n**Testing:**\n- Run `npx tsc --noEmit` after fixes\n- Verify no type errors remain\n- Ensure application still builds and runs correctly","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T15:03:54.608771098+07:00","created_by":"ivan","updated_at":"2026-01-05T15:03:57.828365533+07:00","labels":["typescript"]}
{"id":"cursor-next-template-d1a","title":"Feature: Preserve chat history in AI dashboard","description":"**Problem:**\nChat messages in the AI dashboard (`app/(auth)/dashboard/ai/`) are currently stored only in-memory using the `useChat` hook from `@ai-sdk/react`. When users refresh the page, navigate away, or clear the chat, all conversation history is lost. This creates a poor user experience as users cannot reference previous conversations or continue discussions across sessions.\n\n**Location:**\n- `app/(auth)/dashboard/ai/page.tsx` - Main chat component using `useChat` hook\n- `app/(auth)/dashboard/ai/components/chat-header.tsx` - Clear button that wipes messages\n- `app/api/chat/route.ts` - Chat API endpoint (doesn't persist messages)\n- `prisma/schema.prisma` - No chat-related models exist\n\n**Root Cause:**\n- Messages are managed entirely client-side via `useChat` hook state\n- No database persistence layer for chat sessions or messages\n- No API endpoints for saving/loading chat history\n- Chat history is not associated with authenticated users\n\n**Proposed Solution:**\n\n1. **Database Schema** (`prisma/schema.prisma`):\n   - Create `ChatSession` model to represent conversation sessions\n     - Fields: id, userId (FK to User), title (optional, auto-generated from first message), createdAt, updatedAt\n     - Relation: User has many ChatSessions\n   - Create `ChatMessage` model to store individual messages\n     - Fields: id, sessionId (FK to ChatSession), role (user/assistant/system), content (text), metadata (JSON for attachments, tool calls, etc.), createdAt\n     - Relation: ChatSession has many ChatMessages\n     - Index on sessionId and createdAt for efficient queries\n\n2. **API Endpoints** (`app/api/chat/`):\n   - `POST /api/chat/sessions` - Create new chat session, return sessionId\n   - `GET /api/chat/sessions` - List user's chat sessions\n   - `GET /api/chat/sessions/[id]` - Get session with messages\n   - `POST /api/chat/sessions/[id]/messages` - Save message to session\n   - `DELETE /api/chat/sessions/[id]` - Delete chat session\n   - Modify `POST /api/chat/route.ts` to optionally accept sessionId and save messages\n\n3. **Frontend Integration** (`app/(auth)/dashboard/ai/`):\n   - Create `hooks/use-chat-history.ts` - Custom hook to manage chat persistence\n     - Load existing session or create new one on mount\n     - Save messages to database as they're created\n     - Handle session switching/creation\n   - Update `page.tsx` to:\n     - Initialize with sessionId (from URL param or create new)\n     - Load messages from database on mount\n     - Save messages after each send/receive\n     - Update session title from first user message\n   - Update `chat-header.tsx`:\n     - Add session selector/dropdown for multiple sessions\n     - Update \"Clear\" button to delete current session (not just clear state)\n     - Show session title if available\n\n4. **Authentication Integration**:\n   - Use `auth.api.getSession()` in API routes to get current user\n   - Associate all chat sessions with authenticated user\n   - Ensure users can only access their own chat sessions\n\n**Files to modify:**\n- `prisma/schema.prisma` - Add ChatSession and ChatMessage models\n- `app/api/chat/route.ts` - Add session persistence logic\n- `app/api/chat/sessions/route.ts` - New file for session management\n- `app/api/chat/sessions/[id]/route.ts` - New file for individual session operations\n- `app/api/chat/sessions/[id]/messages/route.ts` - New file for message persistence\n- `app/(auth)/dashboard/ai/page.tsx` - Integrate history loading/saving\n- `app/(auth)/dashboard/ai/hooks/use-chat-history.ts` - New hook for persistence\n- `app/(auth)/dashboard/ai/components/chat-header.tsx` - Add session management UI\n- Migration file - Auto-generated by Prisma\n\n**Testing:**\n- Create new chat session and verify it's saved to database\n- Send messages and verify they're persisted\n- Refresh page and verify messages are restored\n- Create multiple sessions and verify they're listed correctly\n- Delete session and verify it's removed from database\n- Verify users can only access their own sessions\n- Test with attachments and tool calls (ensure metadata is preserved)\n- Test session title generation from first message","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T22:59:26.291885861+07:00","created_by":"ivan","updated_at":"2026-01-05T23:16:30.982120861+07:00","closed_at":"2026-01-05T23:16:30.982120861+07:00","close_reason":"Closed","labels":["database"]}
{"id":"cursor-next-template-f9v","title":"Fix: Replace alert() with toast notifications in project-form","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:50:03.15425281+07:00","created_by":"ivan","updated_at":"2026-01-05T14:50:46.562790091+07:00","closed_at":"2026-01-05T14:50:46.562790091+07:00","close_reason":"Closed","labels":["frontend"]}
{"id":"cursor-next-template-jt3","title":"BUG: Chat history issues - missing user messages and streaming problems","notes":"**Problem:**\nTwo critical bugs affecting chat functionality:\n\n1. **User messages disappear when switching chats**: When switching between chat sessions, user messages (user bubbles) disappear and are not displayed, even though they should be saved in the database.\n\n2. **Streaming not working properly**: The AI response streaming functionality is not working correctly, likely related to how messages are being saved or displayed during the streaming process.\n\n**Location:**\n- `app/(auth)/dashboard/ai/page.tsx` - Main chat component handling message display and streaming\n- `app/(auth)/dashboard/ai/hooks/use-chat-history.ts` - Hook managing session loading and message persistence\n- `app/(auth)/dashboard/ai/components/message-list.tsx` - Component rendering messages\n- `app/api/chat/sessions/[id]/route.ts` - API endpoint loading session messages\n\n**Root Cause Analysis:**\n\n**Issue 1 (Missing user messages):**\n- When `loadSession()` is called, it fetches messages from the database\n- The messages are mapped to `UIMessage[]` format with `parts` array\n- User messages might not be properly formatted or filtered out during the mapping process\n- The `setMessages()` call might be overwriting messages incorrectly\n- Possible issue: User messages saved but not loaded correctly, or messages array is being cleared before loading\n\n**Issue 2 (Streaming problems):**\n- The `useChat` hook from `@ai-sdk/react` handles streaming\n- Messages are saved via `saveMessage()` hook after streaming completes\n- The effect watching for assistant messages might be interfering with streaming\n- Possible race condition: Messages being saved/refreshed during streaming causes UI issues\n- The `status` check might not be correctly detecting when streaming is complete\n\n**Proposed Solution:**\n\n**For Issue 1:**\n1. Verify that user messages are being saved correctly to the database\n2. Check the `loadSession()` function to ensure all messages (user and assistant) are loaded\n3. Verify the message mapping logic correctly handles user messages with `parts` array\n4. Ensure `setMessages()` properly merges or replaces messages without losing user messages\n5. Add logging to track message loading and display\n\n**For Issue 2:**\n1. Review the effect that saves assistant messages - ensure it only triggers when streaming is truly complete\n2. Check if `status === \"streaming\"` is correctly detecting streaming state\n3. Verify that saving messages during streaming doesn't interfere with the stream\n4. Consider debouncing or delaying message saves until streaming fully completes\n5. Ensure the `useChat` hook is properly configured and not being reset during session switches\n\n**Files to modify:**\n- `app/(auth)/dashboard/ai/page.tsx` - Fix message loading and streaming logic\n- `app/(auth)/dashboard/ai/hooks/use-chat-history.ts` - Fix `loadSession()` to properly load all messages\n- `app/(auth)/dashboard/ai/components/message-list.tsx` - Verify message rendering (if needed)\n\n**Testing:**\n1. Create a new chat session and send a user message\n2. Switch to another chat session and back - verify user message is still visible\n3. Send a message and verify streaming works correctly\n4. Verify assistant messages appear during streaming\n5. Verify both user and assistant messages persist after page refresh\n6. Test switching between multiple sessions with messages","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-05T23:33:47.949970797+07:00","created_by":"ivan","updated_at":"2026-01-05T23:33:58.098793634+07:00","labels":["frontend"]}
{"id":"cursor-next-template-r40","title":"cannot add new project in /dashboard button","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T13:54:01.827256862+07:00","created_by":"ivan","updated_at":"2026-01-05T14:48:16.865286734+07:00","closed_at":"2026-01-05T14:48:16.865286734+07:00","close_reason":"Closed"}
